<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Narrative Viz Project - Zubair Lalani</title>

    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://d3js.org/d3-cloud.v1.min.js"></script>
    <script src="scripts/index.js"></script>

    <link rel="stylesheet" href="styles/style.css"> 
    <style>
        #wordcloud {
            font-family: "Arial", sans-serif;
            width: 800px;
            height: 500px;
            margin: auto;
            border: 1px solid #ccc;
        }
    </style>

</head>

<body>
    
    <p>
        In life we have many goals. We want to have friends, relationships, work, but really what it all boils down to is happiness. 
        In the next few slides, we will try to find the truth about what really makes us happy. Is it our career? Money? Feeling attractive? 
        Let's explore!
    </p>

    <div id="chart"></div>
    <script>
        const stopWords = new Set([
            'i', 'me', 'my', 'myself', 'we', 'our', 'ours', 'ourselves', 'you', 'your', 'yours',
            'yourself', 'yourselves', 'he', 'him', 'his', 'himself', 'she', 'her', 'hers', 'herself',
            'it', 'its', 'itself', 'they', 'them', 'their', 'theirs', 'themselves', 'what', 'which',
            'who', 'whom', 'this', 'that', 'these', 'those', 'am', 'is', 'are', 'was', 'were', 'be',
            'been', 'being', 'have', 'has', 'had', 'having', 'do', 'does', 'did', 'doing', 'a', 'an',
            'the', 'and', 'but', 'if', 'or', 'because', 'as', 'until', 'while', 'of', 'at', 'by',
            'for', 'with', 'about', 'against', 'between', 'into', 'through', 'during', 'before',
            'after', 'above', 'below', 'to', 'from', 'up', 'down', 'in', 'out', 'on', 'off', 'over',
            'under', 'again', 'further', 'then', 'once', 'here', 'there', 'when', 'where', 'why',
            'how', 'all', 'any', 'both', 'each', 'few', 'more', 'most', 'other', 'some', 'such',
            'no', 'nor', 'not', 'only', 'own', 'same', 'so', 'than', 'too', 'very', 's', 't', 'can',
            'will', 'just', 'don', 'should', 'now', 'day', 'good', 'great', 'week', 'happy'
        ]);

        // Load CSV data
        d3.csv("data/cleaned_hm.csv").then(function(data) {
            let sentences = data.map(d => d.cleaned_hm);
            let wordCounts = countWords(sentences);
            createBarChart(wordCounts.slice(0, 40));
        });

        function countWords(sentences) {
            let wordCounts = {};
            sentences.forEach(function(sentence) {
                let words = sentence.split(/\W+/); // Split by non-word characters
                words.forEach(function(word) {
                    if (word.length > 0) {
                        word = word.toLowerCase();
                        if(!stopWords.has(word)) {
                            if (wordCounts[word]) {
                                wordCounts[word]++;
                            } else {
                                wordCounts[word] = 1;
                            }
                        }
                    }
                });
            });
            
            // Convert object to array
            return Object.keys(wordCounts).map(function(key) {
                return {
                    word: key,
                    count: wordCounts[key]
                };
            }).sort((a, b) => b.count - a.count); // Sort by count
        }

        function createBarChart(data) {
            const margin = {top: 40, right: 30, bottom: 70, left: 60},
                  width = 800 - margin.left - margin.right,
                  height = 500 - margin.top - margin.bottom;

            const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            // X axis
            const x = d3.scaleBand()
                .range([0, width])
                .padding(0.1)
                .domain(data.map(d => d.word));

            svg.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end");

            // Y axis
            const y = d3.scaleLinear()
                .range([height, 0])
                .domain([0, d3.max(data, d => d.count)]);

            svg.append("g")
                .call(d3.axisLeft(y));

            // Bars
            svg.selectAll(".bar")
                .data(data)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.word))
                .attr("width", x.bandwidth())
                .attr("y", d => y(d.count))
                .attr("height", d => height - y(d.count));

            // Add X axis label
            svg.append("text")
                .attr("class", "axis-label")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom - 10)
                .style("text-anchor", "middle")
                .text("Words");

            // Add Y axis label
            svg.append("text")
                .attr("class", "axis-label")
                .attr("transform", "rotate(-90)")
                .attr("x", -height / 2)
                .attr("y", -margin.left + 15)
                .style("text-anchor", "middle")
                .text("Frequency");

            // Add chart title
            svg.append("text")
                .attr("class", "chart-title")
                .attr("x", width / 2)
                .attr("y", -10)
                .text("Word Frequency Bar Chart");
        }
    </script>

    <!-- <script>
        chart(splitByTime=false);
    </script>
    -->

    <button id="navigateButton">Next</button>
    <script>
        document.getElementById("navigateButton").addEventListener("click", function() {
            window.location.href = "index.html";
        });
    </script> 

</body>
